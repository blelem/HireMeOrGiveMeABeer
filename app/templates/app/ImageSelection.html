{% extends "app/layout.html" %}
{% block content %}
{% load staticfiles %}

  <span class="btn btn-primary btn-file">Upload an image set<input type="file" data-bind="event: { fileselect: fileSelected }" multiple >
  </span>

  <img id="my_image" />

    <div class="modal-body">
            <div class="row">
               <div data-bind="foreach: availableInputImages" class="tnList clearfix" >
                  <div class="col-xs-6 col-sm-3 tnHolder "> 
                     <a href="#" class="thumbnail">
                     <img data-bind="attr: { src: image_1 }">
                     <br> 
                     <img data-bind="attr: { src: image_2 }">
                     </a>
                  </div>
               </div>
            </div>
        </div>
{% endblock %}


{% block scripts %}

<script>
// KO viewmodel
	function AppViewModel() {

		var self = this;
	    self.availableInputImages = ko.observableArray([
			{% for image in input_image_list %}
				{ image_1 : "{{ image.thumb1 }}" , 
				  image_2 : "{{ image.thumb2 }}" ,		
				  pk	  : "{{ image.pk }}"  },		
			{% endfor %}
		]);
       
        self.files = [];
        self.fileSelected = function(data, event, numFiles, label) {

            console.log(numFiles);
            console.log(label);
        }

	}

	// Activates knockout.js
	viewModel = new AppViewModel();
	ko.applyBindings(viewModel);


// Add the .clearfix to properly end one row of image.

	$('.tnList >').each(function (index) {
	    if (index % 4 === 1) {
	        $( this ).after('<div class="clearfix visible-xs-block"></div>');
	    }
	    if (index % 4 === 3) {
	         $(this).after('<div class="clearfix"></div>');
	    }
	});

// fire an event called fileselect when a file is selected
    $('.btn-file :file').on('change', function() {
        var input = $(this),
        numFiles = input.get(0).files ? input.get(0).files.length : 1,
        label = input.val().replace(/\\/g, '/').replace(/.*\//, '');
        input.trigger('fileselect', [numFiles, label]);

        var fileSelected = input.get(0).files[0];
        // Using FileReader to display the image content
        var reader = new FileReader();
        reader.onload = function(e) 
            { 
                $("#my_image").attr("src",e.target.result);
           
            };
        reader.readAsDataURL(fileSelected);

   });

  
 </script>
{% endblock %}
